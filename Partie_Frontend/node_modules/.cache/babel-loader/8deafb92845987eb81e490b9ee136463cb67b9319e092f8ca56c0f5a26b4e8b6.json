{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\yujir\\\\Documents\\\\Projet annuel\\\\Projjet_Annuel_Perso\\\\partiefront\\\\src\\\\components\\\\DeleteUser.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { jwtDecode } from 'jwt-decode';\nimport './DeleteUser.css';\nimport Cookies from 'js-cookie';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst DeleteUser = () => {\n  _s();\n  const [password, setPassword] = useState('');\n  const [email, setEmail] = useState('');\n  const [passwordTrue, setPasswordTrue] = useState('');\n  const [token, setToken] = useState('');\n  const [userId, setUserId] = useState('');\n  const [numberfiledelete, setNumberfiledelete] = useState(0);\n  useEffect(() => {\n    const fetchData = async () => {\n      const tokenData = Cookies.get('token');\n      if (tokenData) {\n        const decodedToken = jwtDecode(tokenData);\n        setEmail(decodedToken.email);\n        setPasswordTrue(decodedToken.password);\n        setToken(tokenData);\n        setUserId(decodedToken.id);\n      }\n    };\n    fetchData();\n  }, []);\n  const handleDeleteUser = async () => {\n    try {\n      const data = {\n        email,\n        password\n      };\n      const response = await axios.post('http://localhost:8000/user/deleteUser', data);\n      if (response.status === 200) {\n        alert('User supprimé avec succès');\n        document.cookie = \"token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\n        window.location.href = '/';\n      }\n    } catch (error) {\n      console.error('Une erreur s\\'est produite lors de la suppression', error);\n    }\n  };\n  const handleFileUser = async () => {\n    try {\n      const data = {\n        token,\n        userId\n      };\n      const response = await axios.post('http://localhost:8000/file/deleteAllfileUser', data);\n      if (response.status === 200) {\n        console.log('Fichiers supprimés');\n      }\n    } catch (error) {\n      console.error('Une erreur s\\'est produite lors de la suppression des fichiers', error);\n    }\n  };\n  const handleCountFileUser = async () => {\n    try {\n      const data = {\n        token,\n        userId\n      };\n      const response = await axios.post('http://localhost:8000/file/filecount', data);\n      if (response.status === 200) {\n        setNumberfiledelete(response.data);\n      }\n    } catch (error) {\n      console.error('Une erreur s\\'est produite lors du comptage des fichiers', error);\n    }\n  };\n  const handleSendMail = async () => {\n    try {\n      const data = {\n        to: email,\n        text: 'Votre compte ainsi que vos fichiers ont été supprimés'\n      };\n      const response = await axios.post('http://localhost:8000/user/sendmaildelete', data);\n      if (response.status === 200) {\n        alert('Mail envoyé avec succès');\n      }\n    } catch (error) {\n      console.error('Une erreur s\\'est produite lors de l\\'envoi du mail', error);\n    }\n  };\n  const handleSendMailAdmin = async number => {\n    try {\n      const data = {\n        to: 'admin@example.com',\n        text: `L'utilisateur ${email} a supprimé son compte, ${number} fichiers ont été supprimés`\n      };\n      const response = await axios.post('http://localhost:8000/user/sendmaildelete', data);\n      if (response.status === 200) {\n        alert('Mail admin envoyé avec succès');\n      }\n    } catch (error) {\n      console.error('Une erreur s\\'est produite lors de l\\'envoi du mail admin', error);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (password === passwordTrue) {\n      await handleCountFileUser();\n      await handleSendMailAdmin(numberfiledelete);\n      await handleDeleteUser();\n      await handleFileUser();\n      await handleSendMail();\n    } else {\n      alert('Votre mot de passe est incorrect');\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Pour supprimer votre compte, veuillez entrer votre mot de passe\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"inscription-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        className: \"title\",\n        children: \"Suppression de compte\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"title2\",\n            htmlFor: \"password\",\n            children: \"Mot de passe\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 137,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"password\",\n            id: \"password\",\n            value: password,\n            onChange: e => setPassword(e.target.value),\n            required: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 138,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          children: \"Supprimer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(DeleteUser, \"tfRTNt380UKMAl8NJwinvH/+Guw=\");\n_c = DeleteUser;\nexport default DeleteUser;\nvar _c;\n$RefreshReg$(_c, \"DeleteUser\");","map":{"version":3,"names":["React","useState","useEffect","axios","jwtDecode","Cookies","jsxDEV","_jsxDEV","Fragment","_Fragment","DeleteUser","_s","password","setPassword","email","setEmail","passwordTrue","setPasswordTrue","token","setToken","userId","setUserId","numberfiledelete","setNumberfiledelete","fetchData","tokenData","get","decodedToken","id","handleDeleteUser","data","response","post","status","alert","document","cookie","window","location","href","error","console","handleFileUser","log","handleCountFileUser","handleSendMail","to","text","handleSendMailAdmin","number","handleSubmit","e","preventDefault","children","fileName","_jsxFileName","lineNumber","columnNumber","className","onSubmit","htmlFor","type","value","onChange","target","required","_c","$RefreshReg$"],"sources":["C:/Users/yujir/Documents/Projet annuel/Projjet_Annuel_Perso/partiefront/src/components/DeleteUser.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport axios from 'axios';\r\nimport {jwtDecode} from 'jwt-decode';\r\nimport './DeleteUser.css';\r\nimport Cookies from 'js-cookie';\r\n\r\nconst DeleteUser = () => {\r\n  const [password, setPassword] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [passwordTrue, setPasswordTrue] = useState('');\r\n  const [token, setToken] = useState('');\r\n  const [userId, setUserId] = useState('');\r\n  const [numberfiledelete, setNumberfiledelete] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const tokenData = Cookies.get('token');\r\n      if (tokenData) {\r\n        const decodedToken = jwtDecode(tokenData);\r\n        setEmail(decodedToken.email);\r\n        setPasswordTrue(decodedToken.password);\r\n        setToken(tokenData);\r\n        setUserId(decodedToken.id);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, []);\r\n\r\n  const handleDeleteUser = async () => {\r\n    try {\r\n      const data = {\r\n        email,\r\n        password,\r\n      };\r\n\r\n      const response = await axios.post('http://localhost:8000/user/deleteUser', data);\r\n\r\n      if (response.status === 200) {\r\n        alert('User supprimé avec succès');\r\n        document.cookie = \"token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\r\n        window.location.href = '/';\r\n      }\r\n    } catch (error) {\r\n      console.error('Une erreur s\\'est produite lors de la suppression', error);\r\n    }\r\n  };\r\n\r\n  const handleFileUser = async () => {\r\n    try {\r\n      const data = {\r\n        token,\r\n        userId,\r\n      };\r\n\r\n      const response = await axios.post('http://localhost:8000/file/deleteAllfileUser', data);\r\n\r\n      if (response.status === 200) {\r\n        console.log('Fichiers supprimés');\r\n      }\r\n    } catch (error) {\r\n      console.error('Une erreur s\\'est produite lors de la suppression des fichiers', error);\r\n    }\r\n  };\r\n\r\n  const handleCountFileUser = async () => {\r\n    try {\r\n      const data = {\r\n        token,\r\n        userId,\r\n      };\r\n\r\n      const response = await axios.post('http://localhost:8000/file/filecount', data);\r\n\r\n      if (response.status === 200) {\r\n        setNumberfiledelete(response.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Une erreur s\\'est produite lors du comptage des fichiers', error);\r\n    }\r\n  };\r\n\r\n  const handleSendMail = async () => {\r\n    try {\r\n      const data = {\r\n        to: email,\r\n        text: 'Votre compte ainsi que vos fichiers ont été supprimés',\r\n      };\r\n\r\n      const response = await axios.post('http://localhost:8000/user/sendmaildelete', data);\r\n\r\n      if (response.status === 200) {\r\n        alert('Mail envoyé avec succès');\r\n      }\r\n    } catch (error) {\r\n      console.error('Une erreur s\\'est produite lors de l\\'envoi du mail', error);\r\n    }\r\n  };\r\n\r\n  const handleSendMailAdmin = async (number) => {\r\n    try {\r\n      const data = {\r\n        to: 'admin@example.com',\r\n        text: `L'utilisateur ${email} a supprimé son compte, ${number} fichiers ont été supprimés`,\r\n      };\r\n\r\n      const response = await axios.post('http://localhost:8000/user/sendmaildelete', data);\r\n\r\n      if (response.status === 200) {\r\n        alert('Mail admin envoyé avec succès');\r\n      }\r\n    } catch (error) {\r\n      console.error('Une erreur s\\'est produite lors de l\\'envoi du mail admin', error);\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (password === passwordTrue) {\r\n      await handleCountFileUser();\r\n      await handleSendMailAdmin(numberfiledelete);\r\n      await handleDeleteUser();\r\n      await handleFileUser();\r\n      await handleSendMail();\r\n    } else {\r\n      alert('Votre mot de passe est incorrect');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <p>Pour supprimer votre compte, veuillez entrer votre mot de passe</p>\r\n      <div className=\"inscription-container\">\r\n        <label className=\"title\">Suppression de compte</label>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"form-group\">\r\n            <label className=\"title2\" htmlFor=\"password\">Mot de passe</label>\r\n            <input\r\n              type=\"password\"\r\n              id=\"password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n              required\r\n            />\r\n          </div>\r\n          <button type=\"submit\">Supprimer</button>\r\n        </form>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default DeleteUser;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}